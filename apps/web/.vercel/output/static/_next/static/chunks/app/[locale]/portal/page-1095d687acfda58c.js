(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[834],{8629:function(e,t,r){Promise.resolve().then(r.bind(r,1416)),Promise.resolve().then(r.bind(r,2972)),Promise.resolve().then(r.bind(r,9111))},1416:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return v}});var n=r(7573),s=r(7653),a=r(1695),i=r(3394),c=r(9280),o=r(7200),l=r(2389);let d=(0,l.Z)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),u=(0,l.Z)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var p=r(5555),h=r(1569),m=r(7066),x=r(2359);let f=(0,l.Z)("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),g=(0,l.Z)("settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var y=r(4859);function v(){var e,t;let{logUserAction:r,logError:l,logInfo:v}=(0,o.w)("CustomerPortal"),b=(0,a.useSearchParams)(),j=(0,a.useRouter)(),[N,w]=(0,s.useState)({loading:!0,user:null,error:null,actionInProgress:null}),k=b.get("token");(0,s.useEffect)(()=>{if(!k){w(e=>({...e,loading:!1,error:"Access token required"}));return}T(k)},[k]);let P=(()=>{if(y.env.NEXT_PUBLIC_API_BASE_URL)return y.env.NEXT_PUBLIC_API_BASE_URL;{let e=y.env.NEXT_PUBLIC_DOMAIN||"astropal.io";return"https://api.".concat(e)}})(),E=y.env.NEXT_PUBLIC_SUPPORT_EMAIL||"support@astropal.io",T=async e=>{try{v("Validating user token",{token:e.slice(0,8)});let t=await fetch("".concat(P,"/validate-token?token=").concat(e)),n=await t.json();n.success?(w(e=>({...e,loading:!1,user:n.user})),r("portal_accessed",{userId:n.user.id,tier:n.user.tier})):(w(e=>({...e,loading:!1,error:"Invalid or expired access link"})),l(Error("Token validation failed"),{error:n.error,token:e.slice(0,8)}))}catch(e){w(e=>({...e,loading:!1,error:"Failed to verify access. Please try again."})),l(e,{action:"token_validation"})}},_=async e=>{if(N.user&&k){w(e=>({...e,actionInProgress:"perspective"}));try{r("perspective_change_attempt",{oldPerspective:N.user.perspective,newPerspective:e,userId:N.user.id});let t=await fetch("".concat(P,"/preferences"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(k)},body:JSON.stringify({perspective:e})}),n=await t.json();if(n.success)w(t=>({...t,user:t.user?{...t.user,perspective:e}:null,actionInProgress:null})),r("perspective_changed",{newPerspective:e,userId:N.user.id}),alert("Perspective updated successfully!");else throw Error(n.error||"Failed to update perspective")}catch(t){l(t,{action:"perspective_update",newPerspective:e}),w(e=>({...e,actionInProgress:null})),alert("Failed to update perspective. Please try again.")}}},I=async e=>{if(N.user&&k){w(t=>({...t,actionInProgress:e}));try{r("billing_".concat(e,"_attempt"),{currentTier:N.user.tier,userId:N.user.id});let t=await fetch("".concat(P,"/billing/").concat(e),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(k)}}),n=await t.json();if(n.success)"upgrade"===e&&n.checkoutUrl?(r("billing_redirect_to_stripe",{checkoutUrl:n.checkoutUrl,userId:N.user.id}),window.location.href=n.checkoutUrl):(w(e=>({...e,user:e.user?{...e.user,subscriptionStatus:"canceled"}:null,actionInProgress:null})),r("billing_".concat(e,"_success"),{userId:N.user.id}),alert("Subscription ".concat("cancel"===e?"canceled":"updated"," successfully!")));else throw Error(n.error||"Failed to ".concat(e," subscription"))}catch(r){var t;l(r,{action:"billing_".concat(e),currentTier:null===(t=N.user)||void 0===t?void 0:t.tier}),w(e=>({...e,actionInProgress:null})),alert("Failed to ".concat(e," subscription. Please try again."))}}};if(N.loading)return(0,n.jsxs)("div",{className:"fixed inset-0 bg-black text-white",children:[(0,n.jsx)(c.ED,{}),(0,n.jsx)("div",{className:"relative z-10 h-full flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-purple-500 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-300",children:"Loading your cosmic portal..."})]})})]});if(N.error)return(0,n.jsxs)("div",{className:"fixed inset-0 bg-black text-white",children:[(0,n.jsx)(c.ED,{}),(0,n.jsx)("div",{className:"relative z-10 h-full flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(d,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),(0,n.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Access Error"}),(0,n.jsx)("p",{className:"text-gray-300 mb-4",children:N.error}),(0,n.jsx)("button",{onClick:()=>j.push("/"),className:"px-6 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors",children:"Return Home"})]})})]});if(!N.user)return(0,n.jsxs)("div",{className:"fixed inset-0 bg-black text-white",children:[(0,n.jsx)(c.ED,{}),(0,n.jsx)("div",{className:"relative z-10 h-full flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(u,{className:"w-16 h-16 text-gray-500 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-300",children:"No user data found"})]})})]});let S={trial:{name:"Trial",icon:p.Z,color:"gray"},free:{name:"Free",icon:h.Z,color:"gray"},basic:{name:"Basic",icon:m.Z,color:"blue"},pro:{name:"Pro",icon:x.Z,color:"purple"}};return(0,n.jsxs)("main",{className:"fixed inset-0 bg-black text-white overflow-hidden",children:[(0,n.jsx)(c.ED,{}),(0,n.jsx)("header",{className:"relative z-10 border-b border-gray-800/50",children:(0,n.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-6",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("div",{className:"text-2xl font-bold tracking-wide",children:"ASTROPAL"}),(0,n.jsx)("div",{className:"text-sm text-gray-400",children:"Account Management"})]})})}),(0,n.jsx)("div",{className:"relative z-10 max-w-4xl mx-auto px-4 py-12 h-[calc(100vh-100px)] overflow-y-auto",children:(0,n.jsxs)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-8",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("h1",{className:"text-3xl font-light mb-4",children:"Welcome to Your Cosmic Portal"}),(0,n.jsx)("p",{className:"text-gray-300 text-lg",children:N.user.email})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)(i.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},className:"bg-gray-900/50 backdrop-blur-sm border border-gray-800/50 rounded-xl p-6",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,n.jsx)(f,{className:"w-6 h-6 text-purple-400"}),(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"Current Plan"})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-gray-300",children:"Tier"}),(0,n.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-purple-500/20 text-purple-400 border border-purple-500/30",children:S[N.user.tier].name})]}),"trial"===N.user.tier&&N.user.trialEnd&&(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-gray-300",children:"Trial Ends"}),(0,n.jsx)("span",{className:"text-yellow-400",children:new Date(N.user.trialEnd).toLocaleDateString()})]}),N.user.subscriptionStatus&&(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-gray-300",children:"Status"}),(0,n.jsx)("span",{className:"capitalize ".concat("active"===N.user.subscriptionStatus?"text-green-400":"canceled"===N.user.subscriptionStatus?"text-red-400":"text-yellow-400"),children:N.user.subscriptionStatus})]}),(0,n.jsxs)("div",{className:"pt-4 space-y-2",children:[("trial"===N.user.tier||"free"===N.user.tier)&&(0,n.jsx)("button",{onClick:()=>I("upgrade"),disabled:"upgrade"===N.actionInProgress,className:"w-full py-2 px-4 bg-purple-600 hover:bg-purple-700 disabled:opacity-50 rounded-lg transition-colors",children:"upgrade"===N.actionInProgress?"Processing...":"Upgrade to Basic"}),("basic"===N.user.tier||"pro"===N.user.tier)&&"active"===N.user.subscriptionStatus&&(0,n.jsx)("button",{onClick:()=>I("cancel"),disabled:"cancel"===N.actionInProgress,className:"w-full py-2 px-4 bg-red-600 hover:bg-red-700 disabled:opacity-50 rounded-lg transition-colors",children:"cancel"===N.actionInProgress?"Processing...":"Cancel Subscription"})]})]})]}),(0,n.jsxs)(i.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.2},className:"bg-gray-900/50 backdrop-blur-sm border border-gray-800/50 rounded-xl p-6",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,n.jsx)(g,{className:"w-6 h-6 text-purple-400"}),(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"Newsletter Style"})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-gray-300",children:"Current Perspective"}),(0,n.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-purple-500/20 text-purple-400 border border-purple-500/30 capitalize",children:null===(e=N.user)||void 0===e?void 0:e.perspective})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-gray-300",children:"Focus Areas"}),(0,n.jsx)("span",{className:"text-sm text-gray-400",children:null===(t=N.user)||void 0===t?void 0:t.focusAreas.join(", ")})]}),(0,n.jsxs)("div",{className:"pt-4",children:[(0,n.jsx)("p",{className:"text-sm text-gray-400 mb-3",children:"Switch your newsletter style:"}),(0,n.jsx)("div",{className:"grid grid-cols-2 gap-2",children:["calm","knowledge","success","evidence"].map(e=>{var t,r;return(0,n.jsx)("button",{onClick:()=>_(e),disabled:"perspective"===N.actionInProgress||(null===(t=N.user)||void 0===t?void 0:t.perspective)===e,className:"py-2 px-3 rounded-lg text-sm transition-colors ".concat((null===(r=N.user)||void 0===r?void 0:r.perspective)===e?"bg-purple-500/20 text-purple-400 border border-purple-500/30":"bg-gray-800/50 text-gray-300 hover:bg-gray-700/50 border border-gray-700/50"," disabled:opacity-50"),children:e.charAt(0).toUpperCase()+e.slice(1)},e)})})]})]})]})]}),(0,n.jsxs)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"text-center pt-8 border-t border-gray-800/50",children:[(0,n.jsx)("p",{className:"text-gray-400 text-sm mb-4",children:"Need help? Contact us or return to the main site."}),(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[(0,n.jsx)("button",{onClick:()=>j.push("/"),className:"px-6 py-2 border border-gray-600 text-gray-300 hover:border-gray-500 hover:text-white rounded-lg transition-colors",children:"Return Home"}),(0,n.jsx)("a",{href:"mailto:".concat(E),className:"text-purple-400 hover:text-purple-300 underline",children:E})]})]})]})})]})}},9280:function(e,t,r){"use strict";r.d(t,{ED:function(){return a}});var n=r(7573);r(7653);var s=r(3394);function a(){let e=Array.from({length:200},(e,t)=>({id:t,x:100*Math.random(),y:100*Math.random(),size:3*Math.random()+.5,duration:4*Math.random()+2,delay:5*Math.random()}));return(0,n.jsxs)("div",{className:"fixed inset-0 -z-10 overflow-hidden pointer-events-none",children:[e.map(e=>(0,n.jsx)(s.E.div,{className:"absolute bg-white rounded-full",style:{left:"".concat(e.x,"%"),top:"".concat(e.y,"%"),width:"".concat(e.size,"px"),height:"".concat(e.size,"px")},animate:{opacity:[.1,1,.1],scale:[.8,1.2,.8]},transition:{duration:e.duration,delay:e.delay,repeat:1/0,ease:"easeInOut"}},e.id)),Array.from({length:50},(e,t)=>(0,n.jsx)(s.E.div,{className:"absolute bg-white rounded-full",style:{left:"".concat(100*Math.random(),"%"),top:"".concat(100*Math.random(),"%"),width:"".concat(2*Math.random()+1,"px"),height:"".concat(2*Math.random()+1,"px"),boxShadow:"0 0 6px rgba(255, 255, 255, 0.8)"},animate:{opacity:[.2,.9,.2],scale:[1,1.5,1]},transition:{duration:6*Math.random()+3,delay:8*Math.random(),repeat:1/0,ease:"easeInOut"}},"bright-".concat(t))),Array.from({length:5},(e,t)=>(0,n.jsx)(s.E.div,{className:"absolute bg-gradient-to-r from-transparent via-white to-transparent h-px",style:{width:"100px",left:"".concat(50*Math.random(),"%"),top:"".concat(50*Math.random(),"%"),transform:"rotate(45deg)"},animate:{x:["0vw","100vw"],opacity:[0,1,0]},transition:{duration:2,delay:15*Math.random()+5,repeat:1/0,ease:"easeOut"}},"shooting-".concat(t)))]})}},7200:function(e,t,r){"use strict";r.d(t,{k:function(){return a},w:function(){return i}});var n=r(7653);class s{log(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};({timestamp:new Date().toISOString(),component:r.component||"unknown",...r})}debug(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("debug",e,t)}info(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("info",e,t)}warn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("warn",e,t)}error(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("error",e,t)}constructor(){this.currentLevel="warn"}}let a=new s,i=e=>((0,n.useEffect)(()=>(a.debug("".concat(e," mounted"),{component:e}),()=>a.debug("".concat(e," unmounted"),{component:e})),[e]),{logUserAction:function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.info("User: ".concat(t),{component:e,action:t,...r})},logError:function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.error("Error in ".concat(e),{component:e,error:t.message,...r})},logInfo:function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.info("".concat(e,": ").concat(t),{component:e,...r})},logWarn:function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.warn("".concat(e,": ").concat(t),{component:e,...r})}})},5555:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(2389).Z)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},4859:function(e,t,r){"use strict";var n,s;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(s=r.g.process)?void 0:s.env)?r.g.process:r(9566)},9566:function(e){!function(){var t={229:function(e){var t,r,n,s=e.exports={};function a(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function c(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{r="function"==typeof clearTimeout?clearTimeout:i}catch(e){r=i}}();var o=[],l=!1,d=-1;function u(){l&&n&&(l=!1,n.length?o=n.concat(o):d=-1,o.length&&p())}function p(){if(!l){var e=c(u);l=!0;for(var t=o.length;t;){for(n=o,o=[];++d<t;)n&&n[d].run();d=-1,t=o.length}n=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];o.push(new h(e,t)),1!==o.length||l||c(p)},h.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},r={};function n(e){var s=r[e];if(void 0!==s)return s.exports;var a=r[e]={exports:{}},i=!0;try{t[e](a,a.exports,n),i=!1}finally{i&&delete r[e]}return a.exports}n.ab="//";var s=n(229);e.exports=s}()},2972:function(e,t,r){"use strict";Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return s}});let n=r(951);function s(e){let{reason:t,children:r}=e;if("undefined"==typeof window)throw new n.BailoutToCSRError(t);return r}},9111:function(e,t,r){"use strict";Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return a}});let n=r(7573),s=r(2399);function a(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let r=(0,s.getExpectedRequestStore)("next/dynamic css"),a=[];if(r.reactLoadableManifest&&t){let e=r.reactLoadableManifest;for(let r of t){if(!e[r])continue;let t=e[r].files.filter(e=>e.endsWith(".css"));a.push(...t)}}return 0===a.length?null:(0,n.jsx)(n.Fragment,{children:a.map(e=>(0,n.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:r.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}}},function(e){e.O(0,[934,293,456,744],function(){return e(e.s=8629)}),_N_E=e.O()}]);