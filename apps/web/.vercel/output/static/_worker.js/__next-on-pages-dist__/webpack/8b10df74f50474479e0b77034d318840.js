var B={},rt=(et,st,it)=>(B.__chunk_1309=(z,N,h)=>{"use strict";h.d(N,{getShareCard:()=>l,tS:()=>d,mr:()=>b});var O=h(7177),P=h(1038);async function x(r,p){let u=new TextEncoder,E=await crypto.subtle.importKey("raw",u.encode(r),{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return Array.from(new Uint8Array(await crypto.subtle.sign("HMAC",E,u.encode(p)))).map(k=>k.toString(16).padStart(2,"0")).join("")}var f=h(4562);let y=(()=>process.env.NEXT_PUBLIC_API_BASE_URL?process.env.NEXT_PUBLIC_API_BASE_URL:`https://api.${process.env.NEXT_PUBLIC_DOMAIN||"astropal.io"}`)(),i=process.env.NEXT_PUBLIC_HMAC_SECRET||"";async function T(r,p={}){let u=`${y}${r}`,E=p.body,k=new Headers({"Content-Type":"application/json"});if(p.headers&&new Headers(p.headers).forEach((I,H)=>{k.set(H,I)}),E&&i){let I=await x(i,E);k.set("X-APIsig",I)}f.k.log("debug","API request initiated",{endpoint:r,url:u,method:p.method||"GET",hasBody:!!E,component:"api-client"});let w=await fetch(u,{...p,headers:k});if(!w.ok){let I=Error(`API Error: ${w.status}`);throw f.k.error("API request failed",{endpoint:r,url:u,status:w.status,statusText:w.statusText,error:I.message,component:"api-client"}),I}let q=await w.json();return f.k.log("debug","API request successful",{endpoint:r,status:w.status,component:"api-client"}),q}f.k.log("info","API configuration initialized",{apiBase:y,environment:"production",hasHmacSecret:!!i,component:"api-client"});let A=async r=>{f.k.log("info","User registration attempt",{email:r.email,focuses:r.focuses,locale:r.locale,component:"api-client"});let p=u=>u.includes("evidence-based")?"evidence":u.includes("career")?"success":u.includes("social")?"knowledge":"calm";try{let u=await T("/register",{method:"POST",body:JSON.stringify({email:r.email,birthDate:r.dob,birthLocation:r.birthLocation,birthTime:"12:00",timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,locale:r.locale||"en-US",perspective:p(r.focuses),focusAreas:r.focuses||[],referralCode:r.referral})});return f.k.log("info","User registration successful",{userId:u.user?.id,traceId:u.traceId,perspective:p(r.focuses),component:"api-client"}),u}catch(u){throw f.k.error("Registration API error",{email:r.email,error:u.message,component:"api-client"}),u}},n=async()=>T("/pricing"),l=async r=>T(`/share/${r}`),b=()=>(0,O.D)({mutationFn:A,onError:r=>{f.k.error("Registration mutation error",{error:r.message,component:"api-hooks"})},onSuccess:r=>{f.k.log("info","Registration mutation success",{success:r.success,userId:r.user?.id,component:"api-hooks"})}}),d=()=>(0,P.a)({queryKey:["pricing"],queryFn:n,staleTime:3e5})},B.__chunk_1038=(z,N,h)=>{h.d(N,{a:()=>tt});var O=h(3086),P=h(789),x=h(5712),f=h(2117),y=h(991),i=h(505),T=class extends f.l{constructor(t,e){super(),this.options=e,this.#s=t,this.#a=null,this.#n=(0,y.O)(),this.options.experimental_prefetchInRender||this.#n.reject(Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(e)}#s;#t=void 0;#i=void 0;#e=void 0;#r;#o;#n;#a;#m;#d;#p;#u;#c;#h;#f=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),A(this.#t,this.options)?this.#l():this.updateResult(),this.#v())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return n(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return n(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#R(),this.#C(),this.#t.removeObserver(this)}setOptions(t){let e=this.options,s=this.#t;if(this.options=this.#s.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof(0,i.Nc)(this.options.enabled,this.#t)!="boolean")throw Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#O(),this.#t.setOptions(this.options),e._defaulted&&!(0,i.VS)(this.options,e)&&this.#s.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});let o=this.hasListeners();o&&l(this.#t,s,this.options,e)&&this.#l(),this.updateResult(),o&&(this.#t!==s||(0,i.Nc)(this.options.enabled,this.#t)!==(0,i.Nc)(e.enabled,this.#t)||(0,i.KC)(this.options.staleTime,this.#t)!==(0,i.KC)(e.staleTime,this.#t))&&this.#b();let v=this.#g();o&&(this.#t!==s||(0,i.Nc)(this.options.enabled,this.#t)!==(0,i.Nc)(e.enabled,this.#t)||v!==this.#h)&&this.#y(v)}getOptimisticResult(t){let e=this.#s.getQueryCache().build(this.#s,t),s=this.createResult(e,t);return(0,i.VS)(this.getCurrentResult(),s)||(this.#e=s,this.#o=this.options,this.#r=this.#t.state),s}getCurrentResult(){return this.#e}trackResult(t,e){return new Proxy(t,{get:(s,o)=>(this.trackProp(o),e?.(o),Reflect.get(s,o))})}trackProp(t){this.#f.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){let e=this.#s.defaultQueryOptions(t),s=this.#s.getQueryCache().build(this.#s,e);return s.fetch().then(()=>this.createResult(s,e))}fetch(t){return this.#l({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#e))}#l(t){this.#O();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(i.ZT)),e}#b(){this.#R();let t=(0,i.KC)(this.options.staleTime,this.#t);if(i.sk||this.#e.isStale||!(0,i.PN)(t))return;let e=(0,i.Kp)(this.#e.dataUpdatedAt,t);this.#u=setTimeout(()=>{this.#e.isStale||this.updateResult()},e+1)}#g(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#y(t){this.#C(),this.#h=t,!i.sk&&(0,i.Nc)(this.options.enabled,this.#t)!==!1&&(0,i.PN)(this.#h)&&this.#h!==0&&(this.#c=setInterval(()=>{(this.options.refetchIntervalInBackground||O.j.isFocused())&&this.#l()},this.#h))}#v(){this.#b(),this.#y(this.#g())}#R(){this.#u&&(clearTimeout(this.#u),this.#u=void 0)}#C(){this.#c&&(clearInterval(this.#c),this.#c=void 0)}createResult(t,e){let s,o=this.#t,v=this.options,m=this.#e,U=this.#r,S=this.#o,c=t!==o?t.state:this.#i,{state:D}=t,a={...D},R=!1;if(e._optimisticResults){let g=this.hasListeners(),F=!g&&A(t,e),L=g&&l(t,o,e,v);(F||L)&&(a={...a,...(0,x.z)(D.data,t.options)}),e._optimisticResults==="isRestoring"&&(a.fetchStatus="idle")}let{error:M,errorUpdatedAt:Q,status:_}=a;s=a.data;let Z=!1;if(e.placeholderData!==void 0&&s===void 0&&_==="pending"){let g;m?.isPlaceholderData&&e.placeholderData===S?.placeholderData?(g=m.data,Z=!0):g=typeof e.placeholderData=="function"?e.placeholderData(this.#p?.state.data,this.#p):e.placeholderData,g!==void 0&&(_="success",s=(0,i.oE)(m?.data,g,e),R=!0)}if(e.select&&s!==void 0&&!Z)if(m&&s===U?.data&&e.select===this.#m)s=this.#d;else try{this.#m=e.select,s=e.select(s),s=(0,i.oE)(m?.data,s,e),this.#d=s,this.#a=null}catch(g){this.#a=g}this.#a&&(M=this.#a,s=this.#d,Q=Date.now(),_="error");let K=a.fetchStatus==="fetching",j=_==="pending",V=_==="error",$=j&&K,W=s!==void 0,C={status:_,fetchStatus:a.fetchStatus,isPending:j,isSuccess:_==="success",isError:V,isInitialLoading:$,isLoading:$,data:s,dataUpdatedAt:a.dataUpdatedAt,error:M,errorUpdatedAt:Q,failureCount:a.fetchFailureCount,failureReason:a.fetchFailureReason,errorUpdateCount:a.errorUpdateCount,isFetched:a.dataUpdateCount>0||a.errorUpdateCount>0,isFetchedAfterMount:a.dataUpdateCount>c.dataUpdateCount||a.errorUpdateCount>c.errorUpdateCount,isFetching:K,isRefetching:K&&!j,isLoadingError:V&&!W,isPaused:a.fetchStatus==="paused",isPlaceholderData:R,isRefetchError:V&&W,isStale:b(t,e),refetch:this.refetch,promise:this.#n,isEnabled:(0,i.Nc)(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){let g=Y=>{C.status==="error"?Y.reject(C.error):C.data!==void 0&&Y.resolve(C.data)},F=()=>{g(this.#n=C.promise=(0,y.O)())},L=this.#n;switch(L.status){case"pending":t.queryHash===o.queryHash&&g(L);break;case"fulfilled":(C.status==="error"||C.data!==L.value)&&F();break;case"rejected":(C.status!=="error"||C.error!==L.reason)&&F()}}return C}updateResult(){let t=this.#e,e=this.createResult(this.#t,this.options);this.#r=this.#t.state,this.#o=this.options,this.#r.data!==void 0&&(this.#p=this.#t),(0,i.VS)(e,t)||(this.#e=e,this.#E({listeners:(()=>{if(!t)return!0;let{notifyOnChangeProps:s}=this.options,o=typeof s=="function"?s():s;if(o==="all"||!o&&!this.#f.size)return!0;let v=new Set(o??this.#f);return this.options.throwOnError&&v.add("error"),Object.keys(this.#e).some(m=>this.#e[m]!==t[m]&&v.has(m))})()}))}#O(){let t=this.#s.getQueryCache().build(this.#s,this.options);if(t===this.#t)return;let e=this.#t;this.#t=t,this.#i=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#v()}#E(t){P.Vr.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#e)}),this.#s.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function A(t,e){return(0,i.Nc)(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)||t.state.data!==void 0&&n(t,e,e.refetchOnMount)}function n(t,e,s){if((0,i.Nc)(e.enabled,t)!==!1&&(0,i.KC)(e.staleTime,t)!=="static"){let o=typeof s=="function"?s(t):s;return o==="always"||o!==!1&&b(t,e)}return!1}function l(t,e,s,o){return(t!==e||(0,i.Nc)(o.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&b(t,s)}function b(t,e){return(0,i.Nc)(e.enabled,t)!==!1&&t.isStaleByTime((0,i.KC)(e.staleTime,t))}var d=h(9020),r=h(916);h(7258);var p=d.createContext(function(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}()),u=()=>d.useContext(p),E=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&!e.isReset()&&(t.retryOnMount=!1)},k=t=>{d.useEffect(()=>{t.clearReset()},[t])},w=({result:t,errorResetBoundary:e,throwOnError:s,query:o,suspense:v})=>t.isError&&!e.isReset()&&!t.isFetching&&o&&(v&&t.data===void 0||(0,i.L3)(s,[t.error,o])),q=d.createContext(!1),I=()=>d.useContext(q);q.Provider;var H=t=>{if(t.suspense){let e=o=>o==="static"?o:Math.max(o??1e3,1e3),s=t.staleTime;t.staleTime=typeof s=="function"?(...o)=>e(s(...o)):e(s),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},G=(t,e)=>t.isLoading&&t.isFetching&&!e,J=(t,e)=>t?.suspense&&e.isPending,X=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function tt(t,e){return function(s,o,v){let m=I(),U=u(),S=(0,r.NL)(v),c=S.defaultQueryOptions(s);S.getDefaultOptions().queries?._experimental_beforeQuery?.(c),c._optimisticResults=m?"isRestoring":"optimistic",H(c),E(c,U),k(U);let D=!S.getQueryCache().get(c.queryHash),[a]=d.useState(()=>new o(S,c)),R=a.getOptimisticResult(c),M=!m&&s.subscribed!==!1;if(d.useSyncExternalStore(d.useCallback(Q=>{let _=M?a.subscribe(P.Vr.batchCalls(Q)):i.ZT;return a.updateResult(),_},[a,M]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),d.useEffect(()=>{a.setOptions(c)},[c,a]),J(c,R))throw X(c,a,U);if(w({result:R,errorResetBoundary:U,throwOnError:c.throwOnError,query:S.getQueryCache().get(c.queryHash),suspense:c.suspense}))throw R.error;return S.getDefaultOptions().queries?._experimental_afterQuery?.(c,R),c.experimental_prefetchInRender&&!i.sk&&G(R,m)&&(D?X(c,a,U):S.getQueryCache().get(c.queryHash)?.promise)?.catch(i.ZT).finally(()=>{a.updateResult()}),c.notifyOnChangeProps?R:a.trackResult(R)}(t,T,e)}},B.__chunk_7177=(z,N,h)=>{h.d(N,{D:()=>A});var O=h(9020),P=h(7146),x=h(789),f=h(2117),y=h(505),i=class extends f.l{#s;#t=void 0;#i;#e;constructor(n,l){super(),this.#s=n,this.setOptions(l),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(n){let l=this.options;this.options=this.#s.defaultMutationOptions(n),(0,y.VS)(this.options,l)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#i,observer:this}),l?.mutationKey&&this.options.mutationKey&&(0,y.Ym)(l.mutationKey)!==(0,y.Ym)(this.options.mutationKey)?this.reset():this.#i?.state.status==="pending"&&this.#i.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#i?.removeObserver(this)}onMutationUpdate(n){this.#r(),this.#o(n)}getCurrentResult(){return this.#t}reset(){this.#i?.removeObserver(this),this.#i=void 0,this.#r(),this.#o()}mutate(n,l){return this.#e=l,this.#i?.removeObserver(this),this.#i=this.#s.getMutationCache().build(this.#s,this.options),this.#i.addObserver(this),this.#i.execute(n)}#r(){let n=this.#i?.state??(0,P.R)();this.#t={...n,isPending:n.status==="pending",isSuccess:n.status==="success",isError:n.status==="error",isIdle:n.status==="idle",mutate:this.mutate,reset:this.reset}}#o(n){x.Vr.batch(()=>{if(this.#e&&this.hasListeners()){let l=this.#t.variables,b=this.#t.context;n?.type==="success"?(this.#e.onSuccess?.(n.data,l,b),this.#e.onSettled?.(n.data,null,l,b)):n?.type==="error"&&(this.#e.onError?.(n.error,l,b),this.#e.onSettled?.(void 0,n.error,l,b))}this.listeners.forEach(l=>{l(this.#t)})})}},T=h(916);function A(n,l){let b=(0,T.NL)(l),[d]=O.useState(()=>new i(b,n));O.useEffect(()=>{d.setOptions(n)},[d,n]);let r=O.useSyncExternalStore(O.useCallback(u=>d.subscribe(x.Vr.batchCalls(u)),[d]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),p=O.useCallback((u,E)=>{d.mutate(u,E).catch(y.ZT)},[d]);if(r.error&&(0,y.L3)(d.options.throwOnError,[r.error]))throw r.error;return{...r,mutate:p,mutateAsync:r.mutate}}},B);export{rt as __getNamedExports};
