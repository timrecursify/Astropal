function c(){let t=sessionStorage.getItem("astropal_session_id");return t||(t="sess_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),sessionStorage.setItem("astropal_session_id",t)),t}function m(){const t={},i=new URLSearchParams(window.location.search);return["utm_source","utm_medium","utm_campaign","utm_term","utm_content"].forEach(o=>{const n=i.get(o);n&&(t[o]=n)}),["fbclid","ttclid","gclid"].forEach(o=>{const n=i.get(o);n&&(t[o]=n)}),Object.keys(t).forEach(o=>{sessionStorage.setItem(`astropal_${o}`,t[o])}),t}function u(){const t={};return["utm_source","utm_medium","utm_campaign","utm_term","utm_content","fbclid","ttclid","gclid"].forEach(e=>{const s=sessionStorage.getItem(`astropal_${e}`);s&&(t[e]=s)}),t}function d(){const t=m(),e={...u(),...t};return{utm_source:e.utm_source||void 0,utm_medium:e.utm_medium||void 0,utm_campaign:e.utm_campaign||void 0,utm_term:e.utm_term||void 0,utm_content:e.utm_content||void 0,fbclid:e.fbclid||void 0,ttclid:e.ttclid||void 0,gclid:e.gclid||void 0,page_url:window.location.href,page_title:document.title,referrer:document.referrer||"direct",user_agent:navigator.userAgent,language:navigator.language,screen_resolution:`${screen.width}x${screen.height}`,viewport_size:`${window.innerWidth}x${window.innerHeight}`,timestamp:new Date().toISOString(),timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,session_id:c()}}async function l(t,i,e){const s=e||d(),o={formData:t,variantName:i,visitorData:s},n="/api/submit-form";try{const r=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","User-Agent":navigator.userAgent},body:JSON.stringify(o)});if(!r.ok){const a=await r.json().catch(()=>({}));throw new Error(`Function responded with status: ${r.status}. ${a.message||""}`)}console.log("Form submitted successfully with tracking data:",{variant:i,utm_source:s.utm_source,utm_medium:s.utm_medium,utm_campaign:s.utm_campaign,session_id:s.session_id})}catch(r){throw console.error("Form submission failed:",r),r}}export{d as captureVisitorData,l as submitFormWithTracking};
