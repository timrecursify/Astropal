function i(){let t=sessionStorage.getItem("astropal_session_id");return t||(t="sess_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),sessionStorage.setItem("astropal_session_id",t)),t}function c(){const t={},o=new URLSearchParams(window.location.search);return["utm_source","utm_medium","utm_campaign","utm_term","utm_content"].forEach(e=>{const r=o.get(e);r&&(t[e]=r)}),["fbclid","ttclid","gclid"].forEach(e=>{const r=o.get(e);r&&(t[e]=r)}),Object.keys(t).forEach(e=>{sessionStorage.setItem(`astropal_${e}`,t[e])}),t}function m(){const t={};return["utm_source","utm_medium","utm_campaign","utm_term","utm_content","fbclid","ttclid","gclid"].forEach(a=>{const s=sessionStorage.getItem(`astropal_${a}`);s&&(t[a]=s)}),t}function u(){const t=c();return{...{...m(),...t},page_url:window.location.href,page_title:document.title,referrer:document.referrer||"direct",user_agent:navigator.userAgent,language:navigator.language,screen_resolution:`${screen.width}x${screen.height}`,viewport_size:`${window.innerWidth}x${window.innerHeight}`,timestamp:new Date().toISOString(),timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,session_id:i()}}async function d(t,o,a){const s=a||u(),e={...t,variant:o,ab_test_variant:o,visitor_data:s,submission_timestamp:new Date().toISOString(),form_version:"2.0"},r="https://hooks.zapier.com/test";try{const n=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","User-Agent":navigator.userAgent},body:JSON.stringify(e)});if(!n.ok)throw new Error(`Webhook responded with status: ${n.status}`);console.log("Form submitted successfully with tracking data:",{variant:o,utm_source:s.utm_source,utm_medium:s.utm_medium,utm_campaign:s.utm_campaign,session_id:s.session_id})}catch(n){throw console.error("Form submission failed:",n),n}}export{u as captureVisitorData,d as submitFormWithTracking};
